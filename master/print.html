<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Anoma Specification</title>
        <meta name="robots" content="noindex" />


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="assets/custom.css">

        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="index.html"><strong aria-hidden="true">1.</strong> Index</a></li><li class="chapter-item expanded "><a href="m1.html"><strong aria-hidden="true">2.</strong> M1</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="m1/execution-system.html"><strong aria-hidden="true">2.1.</strong> Execution system</a></li><li class="chapter-item "><a href="m1/masp.html"><strong aria-hidden="true">2.2.</strong> Multi-asset shielded pool</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="m1/masp/trusted-setup.html"><strong aria-hidden="true">2.2.1.</strong> Trusted setup</a></li></ol></li><li class="chapter-item "><a href="m1/governance.html"><strong aria-hidden="true">2.3.</strong> Governance</a></li><li class="chapter-item "><a href="m1/proof-of-stake.html"><strong aria-hidden="true">2.4.</strong> Proof of stake</a></li><li class="chapter-item "><a href="m1/fee-system.html"><strong aria-hidden="true">2.5.</strong> Fee system</a></li><li class="chapter-item "><a href="m1/ethereum-bridge.html"><strong aria-hidden="true">2.6.</strong> Ethereum bridge</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Anoma Specification</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <p>ye have found the Anoma specs</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="m1-overview"><a class="header" href="#m1-overview">M1 Overview</a></h1>
<p>M1 is a sovereign chain that enables full multi-asset privacy for all connected
assets. In order to make M1 a reality, we not only need a name but we also need
a lot of features besides the ZKP circuits. Over time the set of supported
features my be extended to include things like fully programmable VPs and more
advanced circuits.</p>
<h2 id="raison-dêtre"><a class="header" href="#raison-dêtre">Raison d'être</a></h2>
<p>True multi-asset privacy doesn't exist at the moment anywhere. Up until now you
had the choice to build a sovereign chain that reissues assets (ie ZCash) or to
build a privacy preserving solution on existing chains (ie Tornado Cash on
Ethereum). Both have large trade-offs; in the former case users don't have
assets that they actually want to use and in the latter case users leak a ton of
metadata, it's expensive and clunky to use.</p>
<p>In 2022 the timing is right to launch M1, because interoperability in the form 
of IBC is starting to work in practice and that we are ready tech-wise in order
to launch something like M1.</p>
<p>Moreover M1 also presents a very good stepping stone to launch before mainnet
Anoma as the first chain in the Anoma ecosystem. It is expected that M1 is long
lived and supports actual assets and real value after launch; or in other words,
it's a full-fledged public blockchain.</p>
<h2 id="proposed-features"><a class="header" href="#proposed-features">Proposed Features</a></h2>
<h3 id="cryptography"><a class="header" href="#cryptography">Cryptography</a></h3>
<ul>
<li><a href="m1/masp.html">Multi-asset shielded pool circuit</a>
<ul>
<li>Support arbitrary assets</li>
</ul>
</li>
<li><a href="m1/masp/trusted-setup.html">Trusted setup for the circuit</a>
<ul>
<li>Secure and publicly accepted setup (with more than 100 participants)</li>
</ul>
</li>
</ul>
<h3 id="base-ledger"><a class="header" href="#base-ledger">Base Ledger</a></h3>
<ul>
<li><a href="m1/proof-of-stake.html">Proof of Stake</a>
<ul>
<li>Validators can stake assets</li>
<li>Delegators can delegate assets to validators</li>
<li>Creation of a community pool that is spendable by governance</li>
</ul>
</li>
<li><a href="m1/governance.html">Governance</a>
<ul>
<li>Validators can vote and delegators can override their validators vote</li>
<li>Election of a technical committee that can propose and review community
funding</li>
</ul>
</li>
<li><a href="m1/fee-system.html">Gas/Fee system</a>
<ul>
<li>Transactions can't spam the network</li>
</ul>
</li>
<li><a href="m1/execution-system.html">Execution system</a>
<ul>
<li>VPs with initial whitelisting</li>
</ul>
</li>
</ul>
<h3 id="incentives--rewards--economics"><a class="header" href="#incentives--rewards--economics">Incentives / Rewards / Economics</a></h3>
<ul>
<li>Long-term incentives around PoS and Slashing</li>
<li>Short-term incentives for MASP and bridges</li>
</ul>
<h3 id="bridges"><a class="header" href="#bridges">Bridges</a></h3>
<ul>
<li>Bridge to IBC chains (Osmosis, Cosmos, E-Money, Terra)</li>
<li><a href="m1/ethereum-bridge.html">Bridge to Ethereum</a></li>
<li>All bridges need to be thoroughly tested and running on internal testnets</li>
</ul>
<h3 id="front-ends"><a class="header" href="#front-ends">Front-ends</a></h3>
<ul>
<li>
<p>Multi-chain/Multi-asset wallet that supports moving assets across bridges</p>
<ul>
<li>Enables ETH to be moved to M1 and back</li>
<li>Supports staking and governance on M1</li>
<li>Enables multi-asset transfers involving the MASP</li>
<li>Integrates with existing key solutions (Ledger, Metamask, Keplr)</li>
<li>Supports whatever incentives schemes we want to have</li>
</ul>
</li>
<li>
<p>Block explorer</p>
<ul>
<li>Display PoS state</li>
<li>Display governance state</li>
<li>Display transparent transfers</li>
<li>Display transfers in and out of the MASP</li>
<li>Display total values for the MASP</li>
<li>Allows tx hashes of shielded transfers to be looked up for confirmation</li>
</ul>
</li>
</ul>
<h3 id="testnets"><a class="header" href="#testnets">Testnets</a></h3>
<ul>
<li>Private testnets
<ul>
<li>Just us</li>
</ul>
</li>
<li>Internal testnets
<ul>
<li>Small select group of people</li>
</ul>
</li>
<li>Public testnets
<ul>
<li>Anyone that wants to join</li>
</ul>
</li>
<li>Incentivized testnets</li>
</ul>
<h3 id="integrations"><a class="header" href="#integrations">Integrations</a></h3>
<ul>
<li>Custodians
<ul>
<li>Aegies</li>
</ul>
</li>
<li>Indexer for M1 to integrate with block explorers</li>
<li>Validator tooling</li>
<li>Stakeholder support
<ul>
<li>Rosetta integration</li>
<li>Datahub integration</li>
</ul>
</li>
<li>WalletConnect integration</li>
<li>Ledger integration</li>
<li>External integrations
<ul>
<li>Figment</li>
<li>P2P</li>
<li>Indexers &amp; Explorers</li>
</ul>
</li>
</ul>
<h3 id="standards"><a class="header" href="#standards">Standards</a></h3>
<ul>
<li>Token standard</li>
<li>NFT standard</li>
</ul>
<h2 id="proposed-timeline"><a class="header" href="#proposed-timeline">Proposed Timeline</a></h2>
<p>I'm proposing an aggressive timeline, because we have to acknowledge that if we 
ship M1 in 2023, then it's too late. The goal is to publically launch M1 in
summer 2022, around August.</p>
<p>The major milestones that we can focus around are the testnets and other things,
such as UIs and Trusted Setups can be timelined based on the testnets.</p>
<ul>
<li>Private testnets
<ul>
<li>End of February</li>
<li>Things can still be janky but we should have a working chain on which we can
test the majority of functionality</li>
</ul>
</li>
<li>Internal testnets
<ul>
<li>End of March</li>
<li>Friends and family can start running our testnets</li>
<li>We are starting to have the first UIs that are working and Ledger apps are
in testing</li>
</ul>
</li>
<li>Public testnets
<ul>
<li>End of April</li>
<li>The software is stable enough and we have enough documentation that 
strangers on the internet can run it</li>
<li>Trusted setup should be done.</li>
</ul>
</li>
<li>Incentivized testnets
<ul>
<li>End of May</li>
<li>The incentivized testnets can run for the next 2 months while the last 
remaining bits are polished. Participants receive tokens and we are spending
those 2 months gearing up for launch.</li>
</ul>
</li>
</ul>
<h2 id="milestones"><a class="header" href="#milestones">Milestones</a></h2>
<h3 id="1st-milestone"><a class="header" href="#1st-milestone">1st Milestone</a></h3>
<ul>
<li>Deadline: End of February</li>
<li>Components
<ul>
<li>Private testnet</li>
<li>Prototype UI</li>
<li>Prototype for all protocol components</li>
</ul>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="execution-system"><a class="header" href="#execution-system">Execution system</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="masp"><a class="header" href="#masp">MASP</a></h1>
<p>This specification should cover:</p>
<ul>
<li>Cryptography (can link to existing MASP spec for now)</li>
<li>Ledger integration</li>
<li>Shielded pool incentives</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="trusted-setup"><a class="header" href="#trusted-setup">Trusted setup</a></h1>
<h2 id="what-is-the-anoma-setup"><a class="header" href="#what-is-the-anoma-setup">What is the Anoma Setup?</a></h2>
<p>To enable private asset-agnostic bartering among any number of parties, Anoma uses a Multi-Asset Shielded Pool (MASP) circuit which is an extension of the Sapling circuit used in Zcash. This relies on a specific class of zero-knowledge proofs called Zero-knowledge succinct non-interactive arguments of knowledge (zk-SNARKs). Zk-SNARKs are secure in the common reference string (CRS) model, which assumes a trusted setup of parameters used for constructing and verifying proofs. In order to ensure the parameters are secure, we are running a Multi-Party Computation (MPC) protocol, more commonly called Trusted Setup Ceremony. The ceremony guarantees that proofs cannot be forged when at least one participant is honest, and guarantee zero-knowledge even if none of the participants are honest.</p>
<h2 id="how-exactly-does-the-setup-work"><a class="header" href="#how-exactly-does-the-setup-work">How exactly does the setup work?</a></h2>
<p>A trusted setup consists in 2 phases. The first phase is circuit-agnostic, that is, anyone who wants to build a zk-SNARK can use the outputs from this phase to bootstrap their zk-SNARK. This phase is called The Powers of Tau and has already been done by Zcash. The second phase is circuit-specific and that is where we will construct our MASP zk-SNARK circuit itself.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="governance"><a class="header" href="#governance">Governance</a></h1>
<p>This specification should cover:</p>
<ul>
<li>Protocol for signalling proposals, voting, and tallying</li>
<li>Protocol for posting data on-chain</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="proof-of-stake"><a class="header" href="#proof-of-stake">Proof of stake</a></h1>
<p>This specification should cover</p>
<ul>
<li>Proof-of-stake bonding mechanism (already covered in ledger docs)</li>
<li>Slashing mechanism &amp; infractions</li>
<li>Rewards &amp; distribution</li>
</ul>
<h2 id="slashing"><a class="header" href="#slashing">Slashing</a></h2>
<ul>
<li>Slashing should happen for all of the Tendermint-recognised faults.</li>
</ul>
<h2 id="rewards"><a class="header" href="#rewards">Rewards</a></h2>
<p>Until we have programmable validity predicates, rewards can use the mechanism outlined in the <a href="https://drops.dagstuhl.de/opus/volltexte/2020/11974/pdf/OASIcs-Tokenomics-2019-10.pdf">F1 paper</a>, but it should use the exponential model, so that withdrawing rewards more frequently provides no additional benefit (this is a design constraint we should follow in general, we don't want to accidentally encourage transaction spam). This should be written in a way that allows for a natural upgrade to a validator-customisable rewards model (defaulting to this one) if possible.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="fee-system"><a class="header" href="#fee-system">Fee system</a></h1>
<p>This specification should cover:</p>
<ul>
<li>Fee &amp; gas system for M1</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ethereum-bridge"><a class="header" href="#ethereum-bridge">Ethereum bridge</a></h1>
<p>The M1 Ethereum bridge system consists of a few parts:</p>
<ul>
<li>&quot;IBC-adapter&quot; code on the M1 side
<ul>
<li>Allow M1 validators to vote on the latest Ethereum state roots &amp; log roots (check this) for blocks</li>
<li>Allow M1 validity predicates Ethereum state read access through these commitee-voted roots &amp; Merkle proofs</li>
<li>Slash validators using commit-reveal, if they commit to a different root. Failing to reveal is considered a liveness fault.</li>
</ul>
</li>
<li>A set of Ethereum contracts which perform the following functions:
<ul>
<li>Verify Tendermint header updates from M1, and sub-state proofs</li>
<li>Allow Ethereum contracts to send messages to M1 by outputting logs in a particular format</li>
<li>Allow Ethereum contracts to receive messages from M1 by verifying message commitments in the M1 state Merkle tree</li>
<li>Handle ICS20-style token transfer messages appropriately with escrow &amp; unescrow on the Ethereum side</li>
<li>Allow for message batching</li>
</ul>
</li>
</ul>
<p>This basic bridge architecture should provide for almost-M1 consensus security for the bridge and free Ethereum state reads on M1, plus bidirectional message passing with reasonably low gas costs on the Ethereum side.</p>
<p>Resources which may be helpful:</p>
<ul>
<li><a href="https://github.com/Gravity-Bridge/Gravity-Bridge/tree/main/solidity">Gravity Bridge Solidity contracts</a></li>
<li><a href="https://github.com/cosmos/ibc/tree/master/spec/app/ics-020-fungible-token-transfer">ICS20</a></li>
<li><a href="https://github.com/aurora-is-near/rainbow-bridge/tree/master/contracts">Rainbow Bridge contracts</a></li>
</ul>
<p>One caveat is that we should check the cost of Tendermint header verification on Ethereum; it can be amortised across packets but this still may be quite high. If it is too high we could try to use a threshold key with Ferveo instead.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript" src="assets/mermaid.min.js"></script>
        <script type="text/javascript" src="assets/mermaid-init.js"></script>

        <script type="text/javascript">
        window.addEventListener('load', function() {
            MathJax.Hub.Register.StartupHook('End', function() {
                window.setTimeout(window.print, 100);
            });
        });
        </script>

    </body>
</html>
